---
title: "Website Analytics for Toronto.ca"
output: html_document
author: "Thamilini P."
date: "December 20, 2022"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Ask Phase

The City of Toronto releases open data with the public. The datasets used contain information on how visitors interact with [toronto.ca](https://www.toronto.ca) website.

### Task/Objective

Analyze traffic and behavior of visitors to a website to improve user's experience.

## Prepare Phase

### Datasets License

All datasets used were made available by the [City of Toronto Open Data Portal](https://open.toronto.ca/about/) under the [Open Government Licence â€“ Toronto](https://open.toronto.ca/open-data-license/).

### Load R Packages

```{r load packages, message=FALSE, warning=FALSE}
library(tidyverse)
library(skimr)
library(janitor)
library(lubridate)
library(ggplot2)
```

### Import dataset as dataframe

```{r message=FALSE, warning=FALSE, paged.print=FALSE}
Key_Metrics <- read_csv("/Users/thamiliniparamanantham/Downloads/web-analytics-monthly-report/202211/Key Metrics.csv")

Browser <- read_csv("/Users/thamiliniparamanantham/Downloads/web-analytics-monthly-report/202211/Browser.csv")

Cities <- read_csv("/Users/thamiliniparamanantham/Downloads/web-analytics-monthly-report/202211/Cities.csv")

Countries <- read_csv("/Users/thamiliniparamanantham/Downloads/web-analytics-monthly-report/202211/Countries.csv")

Hits_by_Hour_of_Day <- read_csv("/Users/thamiliniparamanantham/Downloads/web-analytics-monthly-report/202211/Hits by Hour of Day.csv")

Mobile_Devices <- read_csv("/Users/thamiliniparamanantham/Downloads/web-analytics-monthly-report/202211/Mobile Devices.csv")

New_Return_Visitors <- read_csv("/Users/thamiliniparamanantham/Downloads/web-analytics-monthly-report/202211/New vs. Return Visitors.csv")

Referring_Site <- read_csv("/Users/thamiliniparamanantham/Downloads/web-analytics-monthly-report/202211/Referring Site.csv")

Top_Pages <- read_csv("/Users/thamiliniparamanantham/Downloads/web-analytics-monthly-report/202211/Top Pages.csv")

Visits_by_Weekday <- read_csv("/Users/thamiliniparamanantham/Downloads/web-analytics-monthly-report/202211/Visits by Day of Week.csv")

```

### Data Credibility/Bias

All datasets were downloaded from the City of Toronto Open Data Portal and contains web analytics during November 2011 (Last refreshed Dec 4, 2022). Therefore this is original data that is cited and current.


## Process Phase


```{r}
skim_without_charts(Key_Metrics)
get_dupes(Key_Metrics)
head(Key_Metrics)
```

Let define some terms:

* Bounce Rate is the percentage of users that enters a site and leaves without taking an action (like viewing other pages, clicking a link, filling a form, etc). Link to [definition](https://backlinko.com/hub/seo/bounce-rate).
* Screen Views Per Session indicates the average number of screens/pages a user views per session.
* Sessions(New) is the number of sessions that consists of new visitors to the website.

Let's add a new column with the exact date.

```{r}
Key_Metrics <- Key_Metrics %>% 
  mutate(Date = make_date(year = 2022,month = 11, day = `Day of Month`))
```

#### Total Sessions

Calculate total sessions for November
```{r}
total_sessions <- Key_Metrics %>% 
  summarise(total_sessions= sum(Sessions[-1]))

total_sessions
```
#### Total Views

```{r}
total_views <- Key_Metrics %>% 
  summarise(total_views= sum(Views[-1]))

total_views
```

#### Average Session Duration

Let's determine the average session duration for the entire month of November.

```{r}
average_session_duration <- Key_Metrics %>% 
  summarise(avg_session_duration = mean(`Avg Session Duration (Sec)`))

#convert to a period
seconds_to_period(average_session_duration)
```

So the average session duration for November 2022 was about 5 Minutes 36 Seconds.

#### Average Bounce Rate

Let's calculate the average bounce rate.

```{r}
avg_bounce_rate <- Key_Metrics %>% 
  summarise(avg_bounce_rate = mean(`Bounce Rate %`))

avg_bounce_rate
```
#### Average Screen Views per Session

Let's calculuate the average screen views per session.

```{r}
avg_screen_views <- Key_Metrics %>% 
  summarise(avg_screen_views = mean(`Screen Views per Session`))

avg_screen_views
```

```{r}
skim_without_charts(Browser)
get_dupes(Browser)
head(Browser)
```

The first row is empty for the Browser Name, because it contains the total Sessions and Views used with any browser.

There are 18 Unique Browser Names

```{r}
unique(Browser$`Browser Name`)
```


```{r}
skim_without_charts(Cities)
get_dupes(Cities)
head(Cities)
```

There are 250 Unique Cities

```{r}
skim_without_charts(Countries)
get_dupes(Countries)
head(Countries)
```


```{r}
skim_without_charts(Hits_by_Hour_of_Day)
get_dupes(Hits_by_Hour_of_Day)
head(Hits_by_Hour_of_Day)
```

Let's create a column with the 12 hour time. (12 hour time is easier for viewers to read and understand)

```{r}
Hits_by_Hour_of_Day <- Hits_by_Hour_of_Day %>% 
  arrange(`Hour of Day`) %>% 
  mutate(time = case_when(
    `Hour of Day` > 12 ~ paste(`Hour of Day`-12,"PM",sep = " "),
    `Hour of Day` == 12 ~ "12 PM",
    `Hour of Day` == 0 ~ "12 AM",
    `Hour of Day` < 12 & `Hour of Day` > 0  ~ paste(`Hour of Day`,"AM",sep = " ")) 
  )

head(Hits_by_Hour_of_Day)
```


```{r}
skim_without_charts(New_Return_Visitors)
get_dupes(New_Return_Visitors)
head(New_Return_Visitors)
```

```{r}
skim_without_charts(Referring_Site)
get_dupes(Referring_Site)
head(Referring_Site)
```


```{r}
skim_without_charts(Top_Pages)
get_dupes(Top_Pages)
head(Top_Pages)
```

Lets create a column with the average view time in minutes.

```{r}
Top_Pages <- Top_Pages %>% 
  mutate(avg_view_time_mins = seconds_to_period(`Avg View Time (Sec)`))

head(Top_Pages)
```
```{r}
skim_without_charts(Visits_by_Weekday)
get_dupes(Visits_by_Weekday)
head(Visits_by_Weekday)
```


## Analyze and Share Phase

Let's take a closer look at Hits_by_Hour_of_Day. The last row of Hits_by_Hour_of_Day does not contain an hour so let's remove that

```{r}
Hits_by_Hour_of_Day <- slice(Hits_by_Hour_of_Day,1:24)
```


Let's plot Hits_by_Hour_of_Day by Hour and Session to view trends. 

```{r}
ggplot(Hits_by_Hour_of_Day,aes(`Hour of Day`,Sessions))+geom_bar(stat='identity')
```

We can see that a significant amount of sessions occurred between 9 AM and 4 PM (16th Hour). Let's calculate the total amount of sessions.

#### Sessions between 9 AM and 4 PM

```{r}
sessions_between_9AM_4PM <- Hits_by_Hour_of_Day %>%
  filter(`Hour of Day`>= 9 & `Hour of Day` <= 16) %>% 
  summarise(session_pct = sum(Sessions))

sessions_between_9AM_4PM

(sessions_between_9AM_4PM/total_sessions)*100
```

This means that 54.7% of total sessions occurred between 9 AM and 4 PM.

#### % of New vs. Returning Users

Let's calculate the percentage of new users and returning users.

```{r}

#Remove the first row
New_Return_Visitors <- slice(New_Return_Visitors, 2:n())

total_users <- New_Return_Visitors %>% 
  summarise(total_users = sum(Users))

total_users

New_Return_Visitors <- New_Return_Visitors %>% 
  mutate(Users_pct = (Users/sum(Users))*100)

head(New_Return_Visitors)

ggplot(New_Return_Visitors, aes(x="", y=Users_pct, fill=`New-Returning User`)) + geom_bar(stat="identity", width=1) + coord_polar("y", start=0)

```

So 81.9% of total users are new users, while only 18.1% of total users are returning users.

#### Top 5 Browsers and Mobile Devices

```{r}
head(Browser)

head(Mobile_Devices)
```

This list is useful to ensure that the website is accessible through the listed Browsers and Devices.
Let calculate the % of sessions involved a Mobile Device.

```{r}
mobile_devices_total_session <- Mobile_Devices %>% 
  summarise(mobile_devices_total_session = sum(Sessions[-1]))

mobile_devices_pct <- (mobile_devices_total_session/total_sessions)*100

mobile_devices_total_session 

mobile_devices_pct
```

Only 6.4% of Total Sessions involved a Mobile Device. 

#### Most Popular Page

```{r}
head(Top_Pages)
```
The toronto.ca Homepage was the most popular page and was viewed for an average of 2 Minutes and 3 Seconds. 

#### Recommendations

The purpose of a city website is to provide information and services for residents. Residents would visit the site to  
  
